Here is Lab_20_0 focused on using RMAN on Oracle 19.3.0:

---

### Lab_20_0: Using RMAN on Oracle 19.3.0

#### Objectives:
- Understand the features and functions of Recovery Manager (RMAN).
- Configure and manage RMAN settings.
- Perform various RMAN operations including backups, restores, and recovery.

#### Use Case:
As a Database Administrator (DBA), it is crucial to ensure the data integrity and availability of Oracle databases. RMAN is a powerful tool for performing backup and recovery operations, which are essential for data protection and disaster recovery. This lab will guide you through the configuration and usage of RMAN, ensuring that you can effectively manage backup and recovery processes.

#### Environment:
- **Database:** CDBLAB
- **PDBs:** PDBLAB1, PDBLAB2

### Steps:

#### Part 1: Introduction to RMAN
- **Why RMAN:** RMAN provides a comprehensive, high-performance, and reliable backup and recovery solution for Oracle databases. It automates administration tasks related to backup and recovery and integrates with other Oracle features like Data Guard and Oracle Secure Backup.

#### Part 2: Connecting to RMAN
- **Connect to RMAN:**

```bash
rman target /
```

- **Explanation:** Connecting to RMAN without specifying a target database will connect to the default database. RMAN allows you to manage backups, recover databases, and perform other related tasks.

- **Explore RMAN Configuration:**

```bash
SHOW ALL;
```

- **Explanation:** This command displays the current RMAN configuration settings. Itâ€™s essential to review and understand these settings as they dictate how RMAN will perform backup and recovery operations.

#### Part 3: Configuring RMAN Settings
- **Configure Backup Settings:**

```bash
CONFIGURE RETENTION POLICY TO RECOVERY WINDOW OF 7 DAYS;
CONFIGURE BACKUP OPTIMIZATION ON;
CONFIGURE DEFAULT DEVICE TYPE TO DISK;
CONFIGURE CONTROLFILE AUTOBACKUP ON;
CONFIGURE DEVICE TYPE DISK PARALLELISM 2 BACKUP TYPE TO BACKUPSET;
CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE DISK TO 1;
CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE DISK TO 1;
```

- **Explanation:** These commands configure RMAN to retain backups for 7 days, enable backup optimization to avoid redundant backups, and set the default device type to disk. The commands also configure control file autobackup and set parallelism for disk backups.

#### Part 4: Performing RMAN Backups
- **Full Database Backup:**

```bash
RUN {
  ALLOCATE CHANNEL c1 DEVICE TYPE DISK FORMAT '/u01/backups/full_%U.bkp';
  BACKUP DATABASE PLUS ARCHIVELOG;
  RELEASE CHANNEL c1;
}
```

- **Explanation:** This script allocates a channel for the backup operation, performs a full database backup along with all archived redo logs, and stores the backup files in the specified location.

#### Part 5: Performing RMAN Restores
- **Restore Database:**

```bash
RUN {
  SHUTDOWN IMMEDIATE;
  STARTUP MOUNT;
  RESTORE DATABASE;
  RECOVER DATABASE;
  ALTER DATABASE OPEN;
}
```

- **Explanation:** This script is used to restore and recover the entire database from backups. It is crucial in disaster recovery scenarios where the database needs to be restored to a consistent state.

#### Part 6: Performing RMAN Recovery
- **Performing a Point-in-Time Recovery:**

```bash
RUN {
  SET UNTIL TIME 'SYSDATE-1'; 
  RESTORE DATABASE;
  RECOVER DATABASE;
  ALTER DATABASE OPEN RESETLOGS;
}
```

- **Explanation:** This script recovers the database to a specific point in time, which is useful in cases where you need to revert the database to a state before a critical failure or data corruption occurred.

#### Part 7: RMAN Maintenance Tasks
- **Delete Obsolete Backups:**

```bash
DELETE OBSOLETE;
```

- **Explanation:** This command removes all backups and archived logs that are no longer needed based on the retention policy. Regularly running this command helps in managing disk space effectively.

- **Crosscheck Backups:**

```bash
CROSSCHECK BACKUP;
```

- **Explanation:** The CROSSCHECK command verifies the status of backups and archived logs recorded in the RMAN repository. This ensures that the RMAN catalog is synchronized with the actual backup files on disk.

#### Part 8: Scheduling RMAN Backups
- **Schedule Regular Backups:**

Create a shell script (e.g., `daily_backup.sh`) with the following content:

```bash
#!/bin/bash
rman target / <<EOF
RUN {
  BACKUP DATABASE PLUS ARCHIVELOG;
  DELETE OBSOLETE;
}
EXIT;
EOF
```

- **Explanation:** This script performs a daily full backup and deletes obsolete backups. Schedule this script using the cron job scheduler to run automatically at a specified time.

#### Part 9: Summary
In this lab, you explored the features and functions of RMAN, configured RMAN settings, and performed various backup and recovery operations. By mastering RMAN, you are equipped to ensure the integrity and availability of your Oracle databases, providing robust protection against data loss.

#### References:
- [Oracle RMAN Documentation](https://docs.oracle.com/en/database/oracle/oracle-database/19/bradv/oracle-recovery-manager-overview.html)
- [Configuring RMAN](https://docs.oracle.com/en/database/oracle/oracle-database/19/bradv/rman-configuration.html)
- [Performing RMAN Backups and Restores](https://docs.oracle.com/en/database/oracle/oracle-database/19/bradv/performing-backups-and-recoveries.html)

---

This lab will help you understand how to use RMAN effectively on Oracle 19.3.0, from configuring backups to performing complex recovery scenarios.
