### **Lab 13.0: Database Monitoring and Tuning Performance**

---

**Objective:**

- Understand the Automatic Workload Repository (AWR) and Automatic Database Diagnostic Monitor (ADDM).
- Learn how to enable, configure, and use AWR and ADDM to monitor and tune database performance.
- Identify key files and locations related to AWR and ADDM data storage.

---

**Use Case:**

Database performance tuning is a critical part of database administration. As a DBA, you are responsible for ensuring that the database runs efficiently. Monitoring tools like AWR and ADDM allow you to analyze performance data and identify potential issues before they impact the users.

This lab will guide you through the process of enabling and using AWR and ADDM to monitor and tune performance in an Oracle 19.3.0 database environment. You will learn where key performance data files are stored, how to generate reports, and how to interpret them to improve database performance.

---

### **Steps to Complete the Lab**

#### **1. Understanding AWR and ADDM**

**Automatic Workload Repository (AWR):**
- AWR is a built-in repository in Oracle Database that collects, processes, and maintains performance statistics.
- These statistics are stored as snapshots, taken periodically, and can be used for historical analysis and performance tuning.

**Automatic Database Diagnostic Monitor (ADDM):**
- ADDM analyzes the AWR data to identify potential performance bottlenecks.
- It provides actionable recommendations to resolve issues affecting the database’s performance.

---

#### **2. Enabling AWR at the PDB Level**

**Why:** 
Enabling AWR snapshots at the PDB level allows for detailed performance analysis specific to each PDB within a CDB.

**Steps:**

1. **Enable AWR PDB Snapshot Creation:**
   - This command enables the automatic flushing of AWR snapshots at the PDB level.

   **Command:**
   ```sql
   ALTER SYSTEM SET awr_pdb_autoflush_enabled = TRUE;
   ```

2. **Set AWR Snapshot Interval:**
   - Configure the snapshot interval at the PDB level to a desired frequency (e.g., every 60 minutes).

   **Commands:**
   ```sql
   CONNECT sys@PDBLAB1 AS SYSDBA;
   EXEC dbms_workload_repository.modify_snapshot_settings(interval => 60);
   ```

---

#### **3. Executing ADDM Analysis**

**Why:** 
ADDM provides insights and recommendations for performance improvements based on AWR data.

**Steps:**

1. **Run ADDM Analysis Manually:**
   - Execute the ADDM analysis over a range of AWR snapshots.

   **Command:**
   ```sql
   CONNECT sys@PDBLAB1 AS SYSDBA;
   EXEC DBMS_ADDM.ANALYZE_DB(:tname, begin_snapshot => 1, end_snapshot => 2);
   ```

---

#### **4. Identifying Key AWR and ADDM Files**

**Why:** 
Understanding where AWR and ADDM data is stored allows you to manage space and know where to look for historical performance data.

**Steps:**

1. **Locate AWR Data Files:**
   - AWR data is typically stored in the SYSAUX tablespace.
   - Use the following query to check the location and size of the SYSAUX tablespace:

   **Command:**
   ```sql
   SELECT file_name, bytes/1024/1024 AS size_in_mb FROM dba_data_files WHERE tablespace_name = 'SYSAUX';
   ```

2. **Check ADDM Reports:**
   - ADDM reports are generated based on AWR snapshots and are stored within the database.
   - You can view ADDM findings using:

   **Command:**
   ```sql
   SELECT dbms_addm.get_report(:task_name) FROM dual;
   ```

---

#### **5. Generating AWR and ADDM Reports**

**Why:** 
Reports generated by AWR and ADDM provide insights into database performance and help in proactive tuning.

**Steps:**

1. **Generate an AWR Report:**
   - The AWR report provides detailed statistics for a specific time period.

   **Command:**
   ```sql
   @$ORACLE_HOME/rdbms/admin/awrrpt.sql
   ```

   **Explanation:**
   - You’ll be prompted to select the format (HTML or text) and the snapshot range for the report.

2. **Generate an ADDM Report:**
   - The ADDM report provides recommendations based on AWR data.

   **Command:**
   ```sql
   @$ORACLE_HOME/rdbms/admin/addmrpt.sql
   ```

   **Explanation:**
   - You’ll be prompted to select the report type and time period.

---

### **Summary**

In this lab, you enabled and configured AWR and ADDM at the PDB level, identified key locations for performance data storage, and generated reports to analyze and improve database performance. These tools are essential for maintaining the health and efficiency of your Oracle database environment.

### **Useful Links for Reference**

1. [Oracle AWR Documentation](https://docs.oracle.com/en/database/oracle/oracle-database/19/dbrmp/automatic-workload-repository.html)
2. [Oracle ADDM Documentation](https://docs.oracle.com/en/database/oracle/oracle-database/19/dbrmp/automatic-database-diagnostic-monitor.html)
3. [Oracle Database Performance Tuning Guide](https://docs.oracle.com/en/database/oracle/oracle-database/19/tgsql/index.html)

---

This lab provided an overview and hands-on experience with the tools needed to monitor and tune database performance effectively. These skills are vital for any database administrator responsible for maintaining optimal database performance.
