### Lab_16_0: Managing Memory

---

#### Objectives:

1. **Configure and Monitor Memory Components**: Understand how to configure and monitor different memory components within the Oracle Database to optimize performance.
2. **Adjust Memory Settings**: Practice adjusting memory settings for different database components, including the Shared Pool, Database Buffer Cache, and PGA.
3. **Understand Memory Management Options**: Learn the differences between Automatic Shared Memory Management (ASMM), Automatic Memory Management (AMM), and manual memory management.
4. **Manage Memory for Pluggable Databases (PDBs)**: Learn how to manage memory settings specifically for PDBs within a Container Database (CDB).

---

#### Use Case:

Efficient memory management is crucial for maintaining optimal database performance. As databases grow in size and complexity, the need to fine-tune memory components becomes essential. This lab will guide you through configuring, monitoring, and adjusting memory settings within an Oracle Database 19c environment. You will work with different memory components, learn to apply memory management techniques (AMM/ASMM/manual), and specifically manage memory for PDBs within a CDB.

**When/Why**: 

- **When**: During database setup, periodic tuning, or when performance issues arise due to inadequate memory allocation.
- **Why**: Proper memory management can significantly enhance database performance, reduce I/O operations, and ensure efficient resource utilization.

---

### Steps:

#### 1. Configure Shared Pool and Database Buffer Cache
**DB to Use**: `CDBLAB`

1. **Check Current Settings**:
   - Use SQL Developer or SQL*Plus to check the current settings for the Shared Pool and Database Buffer Cache.
   - Command:
     ```sql
     SHOW PARAMETER shared_pool_size;
     SHOW PARAMETER db_cache_size;
     ```
   - **Explanation**: These commands reveal the current allocation for the Shared Pool and Database Buffer Cache, crucial areas for query parsing and data caching.

2. **Modify the Shared Pool and Database Buffer Cache**:
   - Increase the Shared Pool size to 500MB and Database Buffer Cache to 1GB.
   - Command:
     ```sql
     ALTER SYSTEM SET shared_pool_size=500M SCOPE=BOTH;
     ALTER SYSTEM SET db_cache_size=1G SCOPE=BOTH;
     ```
   - **Explanation**: Increasing these sizes can improve the performance of SQL parsing and reduce physical I/O by keeping more data in memory.

3. **Verify Changes**:
   - Check the settings again to ensure the changes have been applied.
   - Command:
     ```sql
     SHOW PARAMETER shared_pool_size;
     SHOW PARAMETER db_cache_size;
     ```

**Expected Results**: The settings should reflect the new sizes, ensuring that more memory is allocated to these critical components.

**Tuning Considerations**: Monitor the usage over time using `V$SGASTAT` and adjust based on application needs and available resources.

---

#### 2. Configure Redo Log Buffer
**DB to Use**: `CDBLAB`

1. **Check Current Redo Log Buffer Size**:
   - Command:
     ```sql
     SHOW PARAMETER log_buffer;
     ```
   - **Explanation**: The Redo Log Buffer holds redo entries generated by DML operations. This setting is vital for ensuring that the redo entries are efficiently written to disk.

2. **Modify Redo Log Buffer Size**:
   - Increase the size to 128MB.
   - Command:
     ```sql
     ALTER SYSTEM SET log_buffer=128M SCOPE=BOTH;
     ```
   - **Explanation**: Increasing the Redo Log Buffer size can reduce wait times associated with redo log writes, particularly in high transaction environments.

3. **Verify Changes**:
   - Command:
     ```sql
     SHOW PARAMETER log_buffer;
     ```

**Expected Results**: The Redo Log Buffer size should now be 128MB, reducing the potential for log buffer space waits.

**Tuning Considerations**: Monitor `V$LOG` and `V$SYSSTAT` for redo log space requests and consider further tuning if necessary.

---

#### 3. Manage Program Global Area (PGA)
**DB to Use**: `PDBLAB1`

1. **Check Current PGA Settings**:
   - Command:
     ```sql
     SHOW PARAMETER pga_aggregate_target;
     SHOW PARAMETER pga_aggregate_limit;
     ```
   - **Explanation**: The PGA is used for session-specific memory requirements like sorting and hash joins. Properly tuning the PGA can reduce disk sorts and improve query performance.

2. **Modify PGA Aggregate Target**:
   - Increase the PGA Aggregate Target to 2GB.
   - Command:
     ```sql
     ALTER SYSTEM SET pga_aggregate_target=2G SCOPE=BOTH;
     ```
   - **Explanation**: Allocating more memory to the PGA can improve the performance of operations that require significant sorting or joining.

3. **Verify Changes**:
   - Command:
     ```sql
     SHOW PARAMETER pga_aggregate_target;
     ```

**Expected Results**: The PGA Aggregate Target should now be set to 2GB, allowing for more in-memory operations.

**Tuning Considerations**: Use `V$PGASTAT` to monitor PGA usage and adjust based on the observed performance and system workload.

---

#### 4. Enable and Configure Automatic Memory Management (AMM)
**DB to Use**: `CDBLAB`

1. **Enable AMM**:
   - Command:
     ```sql
     ALTER SYSTEM SET memory_target=4G SCOPE=SPFILE;
     ALTER SYSTEM SET memory_max_target=4G SCOPE=SPFILE;
     ```
   - **Explanation**: AMM allows Oracle to automatically manage the distribution of memory between the SGA and PGA, ensuring optimal performance without manual intervention.

2. **Restart the Database**:
   - Command:
     ```sql
     SHUTDOWN IMMEDIATE;
     STARTUP;
     ```
   - **Explanation**: Changes to the `memory_target` and `memory_max_target` parameters require a database restart to take effect.

3. **Verify Changes**:
   - Command:
     ```sql
     SHOW PARAMETER memory_target;
     ```

**Expected Results**: AMM should now be enabled, with Oracle dynamically adjusting memory allocation between the SGA and PGA.

**Tuning Considerations**: Monitor memory usage using `V$MEMORY_DYNAMIC_COMPONENTS` and adjust the `memory_max_target` if more memory becomes available.

---

### Summary:
In this lab, you have learned how to configure and monitor various memory components within Oracle Database 19c to optimize performance. You adjusted the Shared Pool, Database Buffer Cache, and PGA settings, and enabled AMM for automatic memory management. These skills are essential for maintaining efficient database operations, especially in environments with fluctuating workloads.

---

### Helpful Links:
1. [Oracle Documentation on Memory Management](https://docs.oracle.com/en/database/oracle/oracle-database/19/dbrm/memory-management.html)
2. [Understanding Oracle Memory Structures](https://www.oracle.com/database/technologies/memory-structures.html)
3. [Performance Tuning Guidelines for Oracle Databases](https://www.oracle.com/database/technologies/performance-tuning.html)
