### Lab_21_1: More on Creating Backups

#### Objective:
This lab will focus on advanced RMAN backup techniques, including configuring block change tracking, using Oracle's suggested backup strategies, backing up the control file to a trace file, and managing backups. You will also explore and configure essential backup-related settings to enhance the backup process.

#### Environment:
- **Database**: CDBLAB
- **PDBs**: PDBLAB1, PDBLAB2

#### Part 1: Configuring Block Change Tracking
**Why**: Block change tracking enables faster incremental backups by tracking changes to data blocks since the last backup. It improves backup performance.

1. **Enable Block Change Tracking**:
   ```sql
   CONNECT sys@CDBLAB AS SYSDBA;
   ALTER DATABASE ENABLE BLOCK CHANGE TRACKING USING FILE '/u01/app/oracle/oradata/CDBLAB/block_change_tracking.bct';
   ```
   - **Explanation**: This command enables block change tracking for the CDB. The file location should be in a directory with sufficient space.

2. **Verify Block Change Tracking**:
   ```sql
   SELECT filename, status FROM v$block_change_tracking;
   ```
   - **Expected Output**: You should see the file path and status showing "ENABLED".

#### Part 2: Using Oracle-Suggested Backup Strategy
**Why**: Oracle provides a suggested backup strategy that is optimized for most environments. This strategy simplifies backup configuration.

1. **Use Oracle-Suggested Backup**:
   ```rman
   RMAN> CONFIGURE DEFAULT DEVICE TYPE TO DISK;
   RMAN> CONFIGURE BACKUP OPTIMIZATION ON;
   RMAN> CONFIGURE CONTROLFILE AUTOBACKUP ON;
   RMAN> CONFIGURE DEVICE TYPE DISK PARALLELISM 2 BACKUP TYPE TO BACKUPSET;
   RMAN> BACKUP DATABASE PLUS ARCHIVELOG;
   ```
   - **Explanation**: This strategy configures RMAN to back up the entire database and includes archived redo logs, ensuring a complete recovery.

#### Part 3: Backing Up the Control File to a Trace File
**Why**: Backing up the control file to a trace file generates a SQL script that can be used to recreate the control file, which is critical for database recovery.

1. **Backup Control File to Trace**:
   ```sql
   ALTER DATABASE BACKUP CONTROLFILE TO TRACE;
   ```
   - **Explanation**: This command creates a trace file containing SQL statements to recreate the control file. It is useful in disaster recovery scenarios.

2. **Locate the Trace File**:
   - **Navigate**: Find the trace file in the directory specified by the `USER_DUMP_DEST` parameter.
   - **Expected Output**: The trace file contains SQL commands for recreating the control file.

#### Part 4: Reporting and Managing Backups
**Why**: Managing and reporting on backups is essential for ensuring that the database is properly protected and that backup policies are being adhered to.

1. **Report on Backups**:
   ```rman
   RMAN> LIST BACKUP;
   RMAN> REPORT NEED BACKUP;
   RMAN> REPORT OBSOLETE;
   ```
   - **Explanation**: These commands provide detailed information about existing backups, including those that are obsolete and need to be deleted.

2. **Catalog Additional Backup Files**:
   ```rman
   RMAN> CATALOG ARCHIVELOG '/disk1/arch_logs/archive1_731.log', '/disk1/arch_logs/archive1_732.log';
   RMAN> CATALOG START WITH '/tmp/arch_logs/';
   ```
   - **Explanation**: This command is used to catalog backup files that are not currently recorded in the RMAN repository, ensuring that all backups are known to RMAN.

3. **Query Dynamic Views for Backup Information**:
   ```sql
   SELECT * FROM v$backup_set;
   SELECT * FROM v$backup_piece;
   SELECT * FROM v$datafile_copy;
   SELECT * FROM v$backup_files;
   ```
   - **Explanation**: These views provide detailed information about the backups stored in the database, allowing you to monitor and manage backups effectively.

#### Part 5: Summary
In this lab, you have configured advanced RMAN backup techniques, including block change tracking, Oracle's suggested backup strategies, and managing backups through various RMAN commands. You also backed up the control file to a trace file and learned how to report on and catalog backups, ensuring that all your backup needs are met.

**Skills Acquired**:
- Configuring block change tracking
- Using Oracle-suggested backup strategies
- Backing up the control file to a trace file
- Managing and reporting on backups

**References**:
- [Oracle RMAN Documentation](https://docs.oracle.com/en/database/oracle/oracle-database/)
- [Configuring Block Change Tracking](https://docs.oracle.com/en/database/oracle/oracle-database/19/bradv/rman-configuring-block-change-tracking.html)
- [RMAN Reporting and Cataloging Backups](https://docs.oracle.com/en/database/oracle/oracle-database/19/bradv/rman-reporting-on-backups.html)

---

Now that you've completed this lab, you're equipped with advanced skills in managing RMAN backups, an essential part of any Oracle DBA's toolkit.
